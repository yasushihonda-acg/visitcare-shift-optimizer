# Product Requirements Document (PRD) - 製品要件定義書

## 1. はじめに
- **製品名**: visitcare-shift-optimizer (Demo)
- **ターゲットユーザー**: 訪問介護事業所のサービス提供責任者（サ責）
- **課題**: スプレッドシートでのパズル作業が限界。移動時間ミスや資格不備、相性NGの見落としが多発

## 2. 機能要件 (Functional Requirements)

### 2.1 データ管理機能
- **Seedデータインポート**: CSV形式で利用者・スタッフ・制約条件を一括取り込み可能
- **マスタ編集**:
  - 利用者詳細: 「同一世帯ID（夫婦）」の設定、「NGスタッフ」「推奨スタッフ」の登録
  - スタッフ詳細: 「保有資格（身体介護可否）」、「移動手段（速度係数）」、「特定利用者への習熟度（同行中/独り立ち）」の設定
- **利用者マスタ拡張フィールド**（全てoptional）:
  - `aozora_id`: あおぞらID（外部連携ID）
  - `phone_number`: 電話番号
  - `home_care_office`: 担当居宅
  - `consultation_support_office`: 相談支援事業所
  - `care_manager_name`: 担当ケアマネ
  - `support_specialist_name`: 相談支援専門員
- **スタッフマスタ拡張フィールド**（全てoptional）:
  - `employee_number`: 社員番号
  - `address`: 住所（テキスト）
  - `location`: 座標（ジオコーディング）
  - `phone_number`: 電話番号
- **研修状態3段階**: `not_visited`（未経験）/ `training`（同行中）/ `independent`（独り立ち）
- **支援類型マスタ**: Firestoreコレクション `service_types` としてコード管理（将来フェーズ）

### 2.2 シフト自動生成機能 (AI Logic)
- **最適化実行**: 対象期間とチームを指定して実行
- **制約ロジック**:

#### ハード制約（必須）
- 資格不適合の禁止（身体介護に無資格者を当てない）
- 移動時間の確保（Google Maps実測値）
- 重複（ダブルブッキング）禁止
- NGスタッフの回避
- 夫婦・連続サービスの同一担当者固定

#### ソフト制約（努力目標）
- 移動時間の最小化
- 担当継続性（前回と同じ人）
- 空き時間の最小化（飛び石連休の回避）

### 2.3 シフト編集・可視化機能 (UI/UX)
- **ガントチャート**: スタッフ軸・時間軸でシフトをバー表示。移動時間を「隙間」として可視化
- **ドラッグ＆ドロップ**: AI作成後の手動調整機能
- **リアルタイムバリデーション**: 手動操作時にルール違反があれば即座に警告（赤枠・ツールチップ）
  - 警告内容例：「移動時間が5分不足」「資格なし（身体）」「同行期間中（単独訪問不可）」「未経験スタッフの単独訪問不可」
- **スケジュール表示軸切替**: 利用者軸 ↔ スタッフ軸 のピボット切替
- **基本予定一覧画面**: 週次の基本シフトパターン一覧表示
- **元支援数 vs 現支援数トラッキング**: 変更前後のサービス件数の比較表示

### 2.4 スコープ外（将来フェーズ）
- 介ソル・カラカラとのデータ突合処理（外部連携IDの保持のみ対応）
- 介護報酬請求（レセプト）データの生成・計算

> **以下は当初スコープ外だったが実装完了済み:**
> - 支援類型マスタの `service_types` Firestoreコレクション化 + マスタ管理UI（PR #103-#105）

## 3. 非機能要件 (Non-Functional Requirements)
- **パフォーマンス**: 最適化計算（スタッフ20名・利用者50名規模）を3分以内に完了
  - 計算時間が長引く場合は、UI上でプログレス表示
- **拡張性**: サービス数が1,000を超えた場合、エリア単位等で分割計算（パーティショニング）できる設計
- **外部連携準備**: 利用者・スタッフIDに「介ソルID」「カラカラID」等の外部キーを保持できるスキーマ設計
